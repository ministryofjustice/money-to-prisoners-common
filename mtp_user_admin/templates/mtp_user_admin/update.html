{% extends "base.html" %}
{% load i18n %}

{% block content %}
<div class="admin">
  <header class="ContentHeader">
    <a href="{% url 'dashboard' %}" class="ContentHeader-back">{% trans 'Home' %}</a>
    <h1>
      {% if form.create %}
        {% trans 'Create a new user' %}
      {% else %}
        {% trans 'Edit user' %} ‘{{ form.username.value }}’
      {% endif %}
    </h1>
  </header>

  {% if form.create %}
  <p>{% trans 'Fill in a user’s details to allow them access. You can give them a general user or admin role.' %}</p>
    {% if permissions_note %}
  <p>{{ permissions_note }}</p>
    {% endif %}
  {% endif %}

  <form action="." method="post" class="admin-form">
    {% csrf_token %}

    {% if form.non_field_errors %}
    <div class="error-summary" aria-labelledby="error-summary-heading" tabindex="-1" role="alert">
      {% for error in form.non_field_errors %}
        {% if forloop.first %}
      <h1 class="error-summary-heading heading-medium" id="error-summary-heading">
        {{ error }}
      </h1>
        {% else %}
        {{ error }}
        {% endif %}
      {% endfor %}
    </div>
    {% endif %}

    {% if form.create %}
      {% with field=form.username %}
    <div class="form-group {% if field.errors %}error{% endif %}">
      <label for="{{ field.id_for_label }}" id="{{ field.id_for_label }}-label" class="form-label">
        {{ field.label }}
      </label>
      <p class="form-hint">{% trans 'Use only letters, digits and @.+-_ (30 characters max)' %}</p>
        {% for error in field.errors %}
      <span class="error-message">{{ error }}</span>
        {% endfor %}
      <input id="{{ field.id_for_label }}" class="form-control" name="{{ field.html_name }}" value="{{ field.value|default:'' }}" {% if not form.create %}disabled{% endif %} type="text" />
    </div>
      {% endwith %}
    {% endif %}

    {% with field=form.first_name %}
      <div class="form-group {% if field.errors %}error{% endif %}">
        <label for="{{ field.id_for_label }}" id="{{ field.id_for_label }}-label" class="form-label">
          {{ field.label }}
        </label>
        {% for error in field.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
        <input id="{{ field.id_for_label }}" class="form-control" name="{{ field.html_name }}" value="{{ field.value|default:'' }}" type="text" />
      </div>
    {% endwith %}

    {% with field=form.last_name %}
      <div class="form-group {% if field.errors %}error{% endif %}">
        <label for="{{ field.id_for_label }}" id="{{ field.id_for_label }}-label" class="form-label">
          {{ field.label }}
        </label>
        {% for error in field.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
        <input id="{{ field.id_for_label }}" class="form-control" name="{{ field.html_name }}" value="{{ field.value|default:'' }}" type="text" />
      </div>
    {% endwith %}

    {% with field=form.email %}
      <div class="form-group {% if field.errors %}error{% endif %}">
        <label for="{{ field.id_for_label }}" id="{{ field.id_for_label }}-label" class="form-label">
          {{ field.label }}
        </label>
        {% for error in field.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
        <input id="{{ field.id_for_label }}" class="form-control" name="{{ field.html_name }}" value="{{ field.value|default:'' }}" type="email" />
      </div>
    {% endwith %}

    {% with field=form.user_admin %}
      <div class="form-group {% if field.errors %}error{% endif %}">
        <label id="{{ field.id_for_label }}-label" class="block-label {% if field.value %}selected{% endif %}">
          <input id="{{ field.id_for_label }}" name="{{ field.html_name }}" {% if field.value %}checked="checked"{% endif %} type="checkbox" />
          {{ field.label }}
        </label>
        {% for error in field.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
      </div>
    {% endwith %}

    <div class="form-group">
      <button type="submit" class="button" name="create">
        {% if form.create %}
          {% trans 'Create' %}
        {% else %}
          {% trans 'Save' %}
        {% endif %}
      </button>
      <a href="{% url 'list-users' %}" class="cancel">{% trans 'Cancel' %}</a>
    </div>
  </form>
</div>
{% endblock %}
