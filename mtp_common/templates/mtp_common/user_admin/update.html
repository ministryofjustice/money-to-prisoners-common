{% extends 'mtp_common/user_admin/base.html' %}
{% load i18n %}
{% load mtp_common %}

{% block admin_header %}
  <header>
    {% language_switch %}
    <h1 class="heading-xlarge">
      {% if form.create %}
        {% trans 'Create a new user' %}
      {% else %}
        {% blocktrans trimmed with username=form.username.value %}
          Edit user ‘{{ username }}’
        {% endblocktrans %}
      {% endif %}
    </h1>
  </header>
{% endblock %}

{% block admin_content %}
  {% if form.create %}
    <p>
      {% trans 'Fill in a user’s details to allow them access.' %}
      {% trans 'You can give them a general user or an account management role.' %}
    </p>
    {% if permissions_note %}
      <p>{{ permissions_note }}</p>
    {% endif %}
  {% endif %}

  <form action="." method="post" class="mtp-account-management__user-form">
    {% csrf_token %}

    {% include 'mtp_common/forms/error-summary.html' with form=form only %}

    {% if form.create %}
      {% with field=form.username %}
        <div class="form-group {% if field.errors %}error{% endif %}">
          {% include 'mtp_common/forms/field-label.html' with field=field only %}
          {% include 'mtp_common/forms/field-errors.html' with field=field only %}
          {% include 'mtp_common/forms/field-help-text.html' with field=field only %}
          <input id="{{ field.id_for_label }}" class="form-control" name="{{ field.html_name }}" value="{{ field.value|default:'' }}" {% if not form.create %}disabled{% endif %} type="text" />
        </div>
      {% endwith %}
    {% endif %}

    {% include 'mtp_common/forms/field.html' with field=form.first_name only %}
    {% include 'mtp_common/forms/field.html' with field=form.last_name only %}
    {% include 'mtp_common/forms/field.html' with field=form.email only %}

    {% with field=form.role %}
      {% if field.field.choices %}
        <fieldset class="form-group {% if field.errors %}error{% endif %}">
          {% include 'mtp_common/forms/field-errors.html' with field=field only %}
          <span id="{{ field.id_for_label }}-label" class="form-label">{% trans 'Give the user access to:' %}</span>
          {% for choice_value, choice_description in field.field.choices %}
            <label class="block-label" for="id_{{ choice_value }}">
              <input id="id_{{ choice_value }}" type="radio" name="{{ field.html_name }}" value="{{ choice_value }}" {% if field.value == choice_value %}checked{% endif %}>
              {{ choice_description }}
            </label>
          {% endfor %}
        </fieldset>
      {% endif %}
    {% endwith %}

    {% with field=form.user_admin %}
      {% if field %}
        <div class="form-group {% if field.errors %}error{% endif %}">
          <label id="{{ field.id_for_label }}-label" class="block-label {% if field.value %}selected{% endif %}">
            <input id="{{ field.id_for_label }}" name="{{ field.html_name }}" {% if field.value %}checked="checked"{% endif %} type="checkbox" />
            {{ field.label }}
          </label>
          {% include 'mtp_common/forms/field-errors.html' with field=field only %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="form-group">
      <button type="submit" class="button" name="create">
        {% if form.create %}
          {% trans 'Create' %}
        {% else %}
          {% trans 'Save' %}
        {% endif %}
      </button>
      <a href="{% url 'list-users' %}" class="cancel">{% trans 'Cancel' %}</a>
    </div>
  </form>
{% endblock %}
